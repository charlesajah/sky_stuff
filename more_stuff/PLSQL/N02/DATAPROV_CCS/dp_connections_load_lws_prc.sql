--------------------------------------------------------
--  File created - Thursday-November-09-2023   
--------------------------------------------------------
--------------------------------------------------------
--  DDL for Procedure DP_CONNECTIONS_LOAD_LWS_PRC
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "DATAPROV"."DP_CONNECTIONS_LOAD_LWS_PRC" as
begin
  --
  insert /*+ append */
  into dataprov.dp_connections_lws
  select
       DECODE(machine,
              'uncsg0ba.bskyb.com','cbs-appointments-service',
              'uncsg0bb.bskyb.com','cbs-appointments-service',
              'uncsg0be.bskyb.com','cbs-appointments-service',
              'uncsg0bf.bskyb.com','cbs-appointments-service',
              'uncsg0bc.bskyb.com','cbs-appointments-service',
              'uncsg0bd.bskyb.com','cbs-appointments-service',
              'uncsg0bg.bskyb.com','cbs-appointments-service',
              'uncsg0bh.bskyb.com','cbs-appointments-service',       
              'uncsg0fa.bskyb.com','cbs-assurance-web',
              'uncsg0fb.bskyb.com','cbs-assurance-web',
              'uncsg0fe.bskyb.com','cbs-assurance-web',
              'uncsg0ff.bskyb.com','cbs-assurance-web',
              'uncsg0fc.bskyb.com','cbs-assurance-web',
              'uncsg0fd.bskyb.com','cbs-assurance-web',
              'uncsg0fg.bskyb.com','cbs-assurance-web',
              'uncsg0fh.bskyb.com','cbs-assurance-web',
              'uncsg16a.bskyb.com','cbs-assurance-service',
              'uncsg16b.bskyb.com','cbs-assurance-service',
              'uncsg16e.bskyb.com','cbs-assurance-service',
              'uncsg16f.bskyb.com','cbs-assurance-service',
              'uncsg16c.bskyb.com','cbs-assurance-service',
              'uncsg16d.bskyb.com','cbs-assurance-service',
              'uncsg16g.bskyb.com','cbs-assurance-service',
              'uncsg16h.bskyb.com','cbs-assurance-service',              
              'uncsg0xa.bskyb.com','cbs-aurrora-web',
              'uncsg0xb.bskyb.com','cbs-aurrora-web',
              'uncsg0xe.bskyb.com','cbs-aurrora-web',
              'uncsg0xf.bskyb.com','cbs-aurrora-web',
              'uncsg0xc.bskyb.com','cbs-aurrora-web',
              'uncsg0xd.bskyb.com','cbs-aurrora-web',
              'uncsg0xg.bskyb.com','cbs-aurrora-web',
              'uncsg0xh.bskyb.com','cbs-aurrora-web',
              'uncsg0ga.bskyb.com','cbs-cas-authentication-web',
              'uncsg0gb.bskyb.com','cbs-cas-authentication-web',
              'uncsg0ge.bskyb.com','cbs-cas-authentication-web',
              'uncsg0gf.bskyb.com','cbs-cas-authentication-web',
              'uncsg0gc.bskyb.com','cbs-cas-authentication-web',
              'uncsg0gd.bskyb.com','cbs-cas-authentication-web',
              'uncsg0gg.bskyb.com','cbs-cas-authentication-web',
              'uncsg0gh.bskyb.com','cbs-cas-authentication-web',
              'uncsg0ha.bskyb.com','cbs-case-management-batch',
              'uncsg0hb.bskyb.com','cbs-case-management-batch',
              'uncsg0he.bskyb.com','cbs-case-management-batch',
              'uncsg0hf.bskyb.com','cbs-case-management-batch',
              'uncsg0hc.bskyb.com','cbs-case-management-batch',
              'uncsg0hd.bskyb.com','cbs-case-management-batch',
              'uncsg0hg.bskyb.com','cbs-case-management-batch',
              'uncsg0hh.bskyb.com','cbs-case-management-batch',      
              'uncsg0va.bskyb.com','cbs-case-management-service',
              'uncsg0vb.bskyb.com','cbs-case-management-service',
              'uncsg0ve.bskyb.com','cbs-case-management-service',
              'uncsg0vf.bskyb.com','cbs-case-management-service',
              'uncsg0vc.bskyb.com','cbs-case-management-service',
              'uncsg0vd.bskyb.com','cbs-case-management-service',
              'uncsg0vg.bskyb.com','cbs-case-management-service',
              'uncsg0vh.bskyb.com','cbs-case-management-service',                       
              'uncsg0wa.bskyb.com','cbs-case-management-web',
              'uncsg0wb.bskyb.com','cbs-case-management-web',
              'uncsg0we.bskyb.com','cbs-case-management-web',
              'uncsg0wf.bskyb.com','cbs-case-management-web',
              'uncsg0wc.bskyb.com','cbs-case-management-web',
              'uncsg0wd.bskyb.com','cbs-case-management-web',
              'uncsg0wg.bskyb.com','cbs-case-management-web',
              'uncsg0wh.bskyb.com','cbs-case-management-web',  
              'uncsg20a.bskyb.com','cbs-customer-service',
              'uncsg20b.bskyb.com','cbs-customer-service',
              'uncsg20e.bskyb.com','cbs-customer-service',
              'uncsg20f.bskyb.com','cbs-customer-service',
              'uncsg20c.bskyb.com','cbs-customer-service',
              'uncsg20d.bskyb.com','cbs-customer-service',
              'uncsg20g.bskyb.com','cbs-customer-service',
              'uncsg20h.bskyb.com','cbs-customer-service', 
              'uncsg0ya.bskyb.com','cbs-customer-timeline-web',
              'uncsg0yb.bskyb.com','cbs-customer-timeline-web',
              'uncsg0ye.bskyb.com','cbs-customer-timeline-web',
              'uncsg0yf.bskyb.com','cbs-customer-timeline-web',
              'uncsg0yc.bskyb.com','cbs-customer-timeline-web',
              'uncsg0yd.bskyb.com','cbs-customer-timeline-web',
              'uncsg0yg.bskyb.com','cbs-customer-timeline-web',
              'uncsg0yh.bskyb.com','cbs-customer-timeline-web', 
              'uncsg21a.bskyb.com','cbs-inventory-service',
              'uncsg21b.bskyb.com','cbs-inventory-service',
              'uncsg21e.bskyb.com','cbs-inventory-service',
              'uncsg21f.bskyb.com','cbs-inventory-service',
              'uncsg21c.bskyb.com','cbs-inventory-service',
              'uncsg21d.bskyb.com','cbs-inventory-service',
              'uncsg21g.bskyb.com','cbs-inventory-service',
              'uncsg21h.bskyb.com','cbs-inventory-service',          
              'uncsg0qa.bskyb.com','cbs-order-management-service',
              'uncsg0qb.bskyb.com','cbs-order-management-service',
              'uncsg0qe.bskyb.com','cbs-order-management-service',
              'uncsg0qf.bskyb.com','cbs-order-management-service',
              'uncsg0qc.bskyb.com','cbs-order-management-service',
              'uncsg0qd.bskyb.com','cbs-order-management-service',
              'uncsg0qg.bskyb.com','cbs-order-management-service',
              'uncsg0qh.bskyb.com','cbs-order-management-service', 
              'uncsg0la.bskyb.com','cbs-payments-service',
              'uncsg0lb.bskyb.com','cbs-payments-service',
              'uncsg0le.bskyb.com','cbs-payments-service',
              'uncsg0lf.bskyb.com','cbs-payments-service',
              'uncsg0lc.bskyb.com','cbs-payments-service',
              'uncsg0ld.bskyb.com','cbs-payments-service',
              'uncsg0lg.bskyb.com','cbs-payments-service',
              'uncsg0lh.bskyb.com','cbs-payments-service',    
              'uncsg0oa.bskyb.com','cbs-payments-web',
              'uncsg0ob.bskyb.com','cbs-payments-web',
              'uncsg0oe.bskyb.com','cbs-payments-web',
              'uncsg0of.bskyb.com','cbs-payments-web',
              'uncsg0oc.bskyb.com','cbs-payments-web',
              'uncsg0od.bskyb.com','cbs-payments-web',
              'uncsg0og.bskyb.com','cbs-payments-web',
              'uncsg0oh.bskyb.com','cbs-payments-web',
              'uncsg0aa.bskyb.com','cbs-sales-dialogue',
              'uncsg0ab.bskyb.com','cbs-sales-dialogue',
              'uncsg0ae.bskyb.com','cbs-sales-dialogue',
              'uncsg0af.bskyb.com','cbs-sales-dialogue',
              'uncsg0ac.bskyb.com','cbs-sales-dialogue',
              'uncsg0ad.bskyb.com','cbs-sales-dialogue',
              'uncsg0ag.bskyb.com','cbs-sales-dialogue',
              'uncsg0ah.bskyb.com','cbs-sales-dialogue',     
              'uncsg0ia.bskyb.com','cbs-transactional-comms',
              'uncsg0ib.bskyb.com','cbs-transactional-comms',
              'uncsg0ie.bskyb.com','cbs-transactional-comms',
              'uncsg0if.bskyb.com','cbs-transactional-comms',
              'uncsg0ic.bskyb.com','cbs-transactional-comms',
              'uncsg0id.bskyb.com','cbs-transactional-comms',
              'uncsg0ig.bskyb.com','cbs-transactional-comms',
              'uncsg0ih.bskyb.com','cbs-transactional-comms',    
              'uncsg0ha.bskyb.com','cbs-transactional-comms-batch',
              'uncsg0hb.bskyb.com','cbs-transactional-comms-batch',
              'uncsg0he.bskyb.com','cbs-transactional-comms-batch',
              'uncsg0hf.bskyb.com','cbs-transactional-comms-batch',
              'uncsg0hc.bskyb.com','cbs-transactional-comms-batch',
              'uncsg0hd.bskyb.com','cbs-transactional-comms-batch',
              'uncsg0hg.bskyb.com','cbs-transactional-comms-batch',
              'uncsg0hh.bskyb.com','cbs-transactional-comms-batch',   
              'uncsg0ea.bskyb.com','cbs-viewing-card-management',
              'uncsg0eb.bskyb.com','cbs-viewing-card-management',
              'uncsg0ee.bskyb.com','cbs-viewing-card-management',
              'uncsg0ef.bskyb.com','cbs-viewing-card-management',
              'uncsg0ec.bskyb.com','cbs-viewing-card-management',
              'uncsg0ed.bskyb.com','cbs-viewing-card-management',
              'uncsg0eg.bskyb.com','cbs-viewing-card-management',
              'uncsg0eh.bskyb.com','cbs-viewing-card-management',   
              'uncsg0da.bskyb.com','cbs-viewing-card-management-web',
              'uncsg0db.bskyb.com','cbs-viewing-card-management-web',
              'uncsg0de.bskyb.com','cbs-viewing-card-management-web',
              'uncsg0df.bskyb.com','cbs-viewing-card-management-web',
              'uncsg0dc.bskyb.com','cbs-viewing-card-management-web',
              'uncsg0dd.bskyb.com','cbs-viewing-card-management-web',
              'uncsg0dg.bskyb.com','cbs-viewing-card-management-web',
              'uncsg0dh.bskyb.com','cbs-viewing-card-management-web',       
              'uncsg0ma.bskyb.com','cbs-customer-management-web',
              'uncsg0mb.bskyb.com','cbs-customer-management-web',
              'uncsg0me.bskyb.com','cbs-customer-management-web',
              'uncsg0mf.bskyb.com','cbs-customer-management-web',
              'uncsg0mc.bskyb.com','cbs-customer-management-web',
              'uncsg0md.bskyb.com','cbs-customer-management-web',
              'uncsg0mg.bskyb.com','cbs-customer-management-web',
              'uncsg0mh.bskyb.com','cbs-customer-management-web',
              'uncsg19a.bskyb.com','cbs-customer-web',
              'uncsg19b.bskyb.com','cbs-customer-web',
              'uncsg19e.bskyb.com','cbs-customer-web',
              'uncsg19f.bskyb.com','cbs-customer-web',
              'uncsg19c.bskyb.com','cbs-customer-web',
              'uncsg19d.bskyb.com','cbs-customer-web',
              'uncsg19g.bskyb.com','cbs-customer-web',
              'uncsg19h.bskyb.com','cbs-customer-web',         
              'uncsg0ca.bskyb.com','mcs-order-management',
              'uncsg0cb.bskyb.com','mcs-order-management',
              'uncsg0ce.bskyb.com','mcs-order-management',
              'uncsg0cf.bskyb.com','mcs-order-management',
              'uncsg0cc.bskyb.com','mcs-order-management',
              'uncsg0cd.bskyb.com','mcs-order-management',
              'uncsg0cg.bskyb.com','mcs-order-management',
              'uncsg0ch.bskyb.com','mcs-order-management', 
              'uncsg22a.bskyb.com','cbs-account-service',
              'uncsg22b.bskyb.com','cbs-account-service',
              'uncsg22e.bskyb.com','cbs-account-service',
              'uncsg22f.bskyb.com','cbs-account-service',
              'uncsg22c.bskyb.com','cbs-account-service',
              'uncsg22d.bskyb.com','cbs-account-service',
              'uncsg22g.bskyb.com','cbs-account-service',
              'uncsg22h.bskyb.com','cbs-account-service',
              'uncsg24a.bskyb.com','delivery-fufillment-service',
              'uncsg24b.bskyb.com','delivery-fufillment-service',
              'uncsg24e.bskyb.com','delivery-fufillment-service',
              'uncsg24f.bskyb.com','delivery-fufillment-service',
              'uncsg24c.bskyb.com','delivery-fufillment-service',
              'uncsg24d.bskyb.com','delivery-fufillment-service',
              'uncsg24g.bskyb.com','delivery-fufillment-service',
              'uncsg24h.bskyb.com','delivery-fufillment-service',  
              'uncsg10a.bskyb.com','cbs-inventory-web',
              'uncsg10b.bskyb.com','cbs-inventory-web',
              'uncsg10e.bskyb.com','cbs-inventory-web',
              'uncsg10f.bskyb.com','cbs-inventory-web',
              'uncsg10c.bskyb.com','cbs-inventory-web',
              'uncsg10d.bskyb.com','cbs-inventory-web',
              'uncsg10g.bskyb.com','cbs-inventory-web',
              'uncsg10h.bskyb.com','cbs-inventory-web',
              'uncsg1ga.bskyb.com','cbs-refdata-service',
              'uncsg1gb.bskyb.com','cbs-refdata-service',
              'uncsg1ge.bskyb.com','cbs-refdata-service',
              'uncsg1gf.bskyb.com','cbs-refdata-service',
              'uncsg1gc.bskyb.com','cbs-refdata-service',
              'uncsg1gd.bskyb.com','cbs-refdata-service',
              'uncsg1gg.bskyb.com','cbs-refdata-service',
              'uncsg1gh.bskyb.com','cbs-refdata-service',
              'uncsg1aa.bskyb.com','cbs-customer-history-service',
              'uncsg1ab.bskyb.com','cbs-customer-history-service',
              'uncsg1ae.bskyb.com','cbs-customer-history-service',
              'uncsg1af.bskyb.com','cbs-customer-history-service',
              'uncsg1ac.bskyb.com','cbs-customer-history-service',
              'uncsg1ad.bskyb.com','cbs-customer-history-service',
              'uncsg1ag.bskyb.com','cbs-customer-history-service',
              'uncsg1ah.bskyb.com','cbs-customer-history-service',    
              'uncsg13a.bskyb.com','cbs-engineer-gateway-service',
              'uncsg13b.bskyb.com','cbs-engineer-gateway-service',
              'uncsg13e.bskyb.com','cbs-engineer-gateway-service',
              'uncsg13f.bskyb.com','cbs-engineer-gateway-service',
              'uncsg13c.bskyb.com','cbs-engineer-gateway-service',
              'uncsg13d.bskyb.com','cbs-engineer-gateway-service',
              'uncsg13g.bskyb.com','cbs-engineer-gateway-service',
              'uncsg13h.bskyb.com','cbs-engineer-gateway-service',  
              'uncsg18a.bskyb.com','cbs-engineer-service',
              'uncsg18b.bskyb.com','cbs-engineer-service',
              'uncsg18e.bskyb.com','cbs-engineer-service',
              'uncsg18f.bskyb.com','cbs-engineer-service',
              'uncsg18c.bskyb.com','cbs-engineer-service',
              'uncsg18d.bskyb.com','cbs-engineer-service',
              'uncsg18g.bskyb.com','cbs-engineer-service',
              'uncsg18h.bskyb.com','cbs-engineer-service',  
              'un000937.bskyb.com','cbs-sales-web',
              'un000938.bskyb.com','cbs-sales-web',
              'un000939.bskyb.com','cbs-sales-web',
              'un000940.bskyb.com','cbs-sales-web',
              'un000941.bskyb.com','cbs-sales-web',
              'un000942.bskyb.com','cbs-sales-web',
              'un000943.bskyb.com','cbs-sales-web',
              'un000944.bskyb.com','cbs-sales-web', 
              'un000592.bskyb.com','cbs-validation-service',
              'un000594.bskyb.com','cbs-validation-service',
              'un000596.bskyb.com','cbs-validation-service',
              'un000598.bskyb.com','cbs-validation-service',
              'un000702.bskyb.com','cbs-catalogue-evaluation-service',
              'un000703.bskyb.com','cbs-catalogue-evaluation-service',
              'un000704.bskyb.com','cbs-catalogue-evaluation-service',
              'un000705.bskyb.com','cbs-catalogue-evaluation-service',
              'un000706.bskyb.com','cbs-catalogue-evaluation-service',
              'un000707.bskyb.com','cbs-catalogue-evaluation-service',
              'un000708.bskyb.com','cbs-catalogue-evaluation-service',
              'un000718.bskyb.com','cbs-catalogue-evaluation-service',  
              'un000710.bskyb.com','cbs-sales-interaction-service',
              'un000711.bskyb.com','cbs-sales-interaction-service',
              'un000712.bskyb.com','cbs-sales-interaction-service',
              'un000713.bskyb.com','cbs-sales-interaction-service',
              'un000714.bskyb.com','cbs-sales-interaction-service',
              'un000715.bskyb.com','cbs-sales-interaction-service',
              'un000716.bskyb.com','cbs-sales-interaction-service',
              'un000717.bskyb.com','cbs-sales-interaction-service',         
              'uncsg30a.bskyb.com','cbs-properties-service',
              'uncsg30b.bskyb.com','cbs-properties-service',
              'uncsg30c.bskyb.com','cbs-properties-service',
              'uncsg30d.bskyb.com','cbs-properties-service',
              'uncsg30e.bskyb.com','cbs-properties-service',
              'uncsg30f.bskyb.com','cbs-properties-service',
              'uncsg30g.bskyb.com','cbs-properties-service',
              'uncsg30h.bskyb.com','cbs-properties-service',
              'BSKYB\WP000093','RetentionService',
              'BSKYB\WP000094','RetentionService',
              'BSKYB\WP000095','RetentionService',
              'BSKYB\WP000096','RetentionService',
              'BSKYB\WP000097','RetentionService',
              'BSKYB\WP000098','RetentionService',
              'un001100.bskyb.com','cbs-loyalty-service',
              'un001101.bskyb.com','cbs-loyalty-service',
              'un001102.bskyb.com','cbs-loyalty-service',
              'un001103.bskyb.com','cbs-loyalty-service',
              'un001104.bskyb.com','cbs-loyalty-service',
              'un001105.bskyb.com','cbs-loyalty-service',
              'un001108.bskyb.com','cbs-loyalty-service',
              'un001109.bskyb.com','cbs-loyalty-service',
              'unknown') Service,
              DECODE(substr(machine,8,1),
              'a','A',
              'b','A',
              'c','B',
              'd','B',
              'e','A',
              'f','A',
              'g','B',
              'h','B',
              null) LEG,
              machine,
           count(*) as total_con,
           count(decode(STATUS, 'ACTIVE', 1)) as active_con,
           ROUND(count(decode(STATUS, 'ACTIVE', 1)) / count(*) * 100, 2) as pct_active,
           sysdate dt
  from sys.v_$session
 where username in ('CBSSERVICES_USER','LWS_CUS_USER','LWS_TCS_USER','LWS_LOS_USER','LWS_RET_USER')
 group by username, machine, PROGRAM
 order by service,machine;
  --
  COMMIT;
  --
end;

/

  GRANT EXECUTE ON "DATAPROV"."DP_CONNECTIONS_LOAD_LWS_PRC" TO "BATCHPROCESS_USER";
