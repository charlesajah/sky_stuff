BEGIN
DBMS_REDEFINITION.CAN_REDEF_TABLE('TCC_OWNER','BSBCOMMSMESSAGEFAILURES', DBMS_REDEFINITION.CONS_USE_ROWID);
END;
/


BEGIN
DBMS_REDEFINITION.CAN_REDEF_TABLE('DEV','TEST', DBMS_REDEFINITION.CONS_USE_ROWID);
END;
/

BEGIN
   DBMS_REDEFINITION.START_REDEF_TABLE(
                      uname => 'DEV',
                      orig_table => 'TEST',
                      int_table => 'INTERIM',
                      options_flag => DBMS_REDEFINITION.CONS_USE_ROWID);
END;
/



DECLARE
   error_count pls_integer := 0;
BEGIN
    DBMS_REDEFINITION.COPY_TABLE_DEPENDENTS('DEV', 'TEST', 'INTERIM', dbms_redefinition.cons_orig_params, TRUE,TRUE,TRUE,FALSE, error_count);
    DBMS_OUTPUT.PUT_LINE('errors := ' || TO_CHAR(error_count));
END;
/


BEGIN
   DBMS_REDEFINITION.SYNC_INTERIM_TABLE('DEV', 'TEST', 'INTERIM');
END;
/


exec DBMS_REDEFINITION.FINISH_REDEF_TABLE('DEV','TEST','INTERIM');

DBMS_REDEFINITION.COPY_TABLE_DEPENDENTS(
   uname                    IN  VARCHAR2,
   orig_table               IN  VARCHAR2,
   int_table                IN  VARCHAR2,
   copy_indexes             IN  PLS_INTEGER := 1,
   copy_triggers            IN  BOOLEAN     := TRUE,
   copy_constraints         IN  BOOLEAN     := TRUE,
   copy_privileges          IN  BOOLEAN     := TRUE,
   ignore_errors            IN  BOOLEAN     := FALSE,
   num_errors               OUT PLS_INTEGER,
   copy_statistics          IN  BOOLEAN     := FALSE, 
   copy_mvlog               IN  BOOLEAN     := FALSE); 
   
   
   
   
   
   
BEGIN
DBMS_REDEFINITION.CAN_REDEF_TABLE('TCC_OWNER','BSBCOMMSMESSAGEFAILURES', DBMS_REDEFINITION.CONS_USE_ROWID);
END;
/



BEGIN
   DBMS_REDEFINITION.START_REDEF_TABLE(
                      uname => 'TCC_OWNER',
                      orig_table => 'BSBCOMMSMESSAGEFAILURES',
                      int_table => 'INTERIM',
                      options_flag => DBMS_REDEFINITION.CONS_USE_ROWID);
END;
/



DECLARE
   error_count pls_integer := 0;
BEGIN
    DBMS_REDEFINITION.COPY_TABLE_DEPENDENTS('TCC_OWNER', 'BSBCOMMSMESSAGEFAILURES', 'INTERIM', dbms_redefinition.cons_orig_params, TRUE,TRUE,TRUE,FALSE, error_count);
    DBMS_OUTPUT.PUT_LINE('errors := ' || TO_CHAR(error_count));
END;
/


BEGIN
   DBMS_REDEFINITION.SYNC_INTERIM_TABLE('TCC_OWNER', 'BSBCOMMSMESSAGEFAILURES', 'INTERIM');
END;
/

exec DBMS_REDEFINITION.FINISH_REDEF_TABLE('TCC_OWNER','BSBCOMMSMESSAGEFAILURES','INTERIM');





CREATE TABLE "TCC_OWNER"."INTERIM" 
   (	"ID" VARCHAR2(32 BYTE) NOT NULL ENABLE, 
	"MESSAGETYPE" VARCHAR2(30 BYTE) NOT NULL ENABLE, 
	"TEMPLATEID" VARCHAR2(30 BYTE), 
	"MESSAGECONTENT" "SYS"."XMLTYPE" , 
	"INVALIDXMLCONTENT" CLOB, 
	"PROCESSSTAGE" VARCHAR2(3 BYTE) NOT NULL ENABLE, 
	"ERRORCODE" VARCHAR2(50 BYTE), 
	"ERRORDESCRIPTION" VARCHAR2(500 BYTE), 
	"ERRORSTACK" CLOB, 
	"REPROCESSEDDATE" DATE, 
	"CREATED" DATE NOT NULL ENABLE, 
	"CREATEDBY" VARCHAR2(32 BYTE) NOT NULL ENABLE, 
	"LASTUPDATE" DATE NOT NULL ENABLE, 
	"UPDATEDBY" VARCHAR2(32 BYTE) NOT NULL ENABLE, 
	"VERSION" NUMBER(12,0) NOT NULL ENABLE, 
	"ORIGINATINGMESSAGEFAILURESID" VARCHAR2(32 BYTE), 
	"ARTIFACTID" VARCHAR2(40 BYTE), 
	"MESSAGECLOB" CLOB, 
	"ROOTMESSAGEFAILUREID" VARCHAR2(32 BYTE), 
	"REPROCESSARTIFACTID" VARCHAR2(40 BYTE), 
	"COMMSREQUESTID" VARCHAR2(47 BYTE), 
	"POINTOFFAILURE" VARCHAR2(50 BYTE), 
	"APPLIEDRULEHISTORYID" VARCHAR2(32 BYTE), 
	 CONSTRAINT "PK_BSBCOMMSMSGFAILURES_ID" PRIMARY KEY ("ID")
  TABLESPACE "TCC_LOB_AUTO_02"  ENABLE
   ) 
 XMLTYPE COLUMN "MESSAGECONTENT" STORE AS SECUREFILE BINARY XML "SFMSGFLRSXMLSEG"(
  TABLESPACE "TCC_LOB_AUTO_02" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE LOGGING  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) ALLOW NONSCHEMA DISALLOW ANYSCHEMA 
 LOB ("INVALIDXMLCONTENT") STORE AS SECUREFILE "SFMSGFLRSINVXMLCLOBSEG"(
  TABLESPACE "TCC_LOB_AUTO_01" ENABLE STORAGE IN ROW CHUNK 8192
  NOCACHE LOGGING  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 LOB ("ERRORSTACK") STORE AS SECUREFILE "SFMSGFLRSERRSTACKCLOBSEG"(
  TABLESPACE "TCC_LOB_AUTO_01" ENABLE STORAGE IN ROW CHUNK 8192
  NOCACHE LOGGING  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 LOB ("MESSAGECLOB") STORE AS SECUREFILE "SFMSGFLRSMSGCLOBSEG"(
  TABLESPACE "TCC_LOB_AUTO_01" ENABLE STORAGE IN ROW CHUNK 8192
  NOCACHE LOGGING  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) ;